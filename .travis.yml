language: ruby
env:
  matrix:
  - DISPLAY=:99.0
  global:
    secure: arVlbmxywQrWCUd9U5cO9lG+qZBXlD01fUG8U1w1DIjEFnaHzyYVEO4PWOWzLGmf2Vmv9OSvL3rhig8sibXaGvT+a1OksrLEApkk3wGvP2shTn8+8KCcEWhuhyZk5QQpfyWmMO4lGfZv1/iXZ9BcRceoEdF+jhpbQstLaL3Q7ZQ=
rvm:
- 1.9.3
before_install:
- "sudo add-apt-repository ppa:git-core/ppa && sudo apt-get update && sudo apt-get -y upgrade && sudo apt-get -y install git git-man git-svn asciidoc"
- "[ ! -e '~/src/git-core' ] && mkdir -p ~/src/git-core"
- "cd ~/src/git-core && apt-get source git-core"
- "cd ~/src/git-core/git-*/contrib/subtree/"
- ls
- "[ -e '/usr/lib/git-core' ] && sed -i -e '/^libexecdir.*/ s|/libexec/|/lib/|' Makefile || echo '/usr/lib/git-core does not exist! Check that your libexec dir exists and reinstall git-subtree'"
- "sudo make prefix=/usr && sudo make prefix=/usr install && sudo make prefix=/usr install-doc"
- cd 
- cd backend
- sudo apt-get update -qq
- sudo apt-get install -qq nodejs
before_script:
- psql -c 'create database yo_test;' -U postgres
- rake db:migrate
- #cd ../web-client
- #npm install grunt --save-dev
- #npm install
- #bower install
- sh -e /etc/init.d/xvfb start
script:
- #cd ../web-client && grunt test
- cd ../backend && bundle exec rspec && bundle exec teaspoon
matrix:
  allow_failures:
  - rvm: jruby-19mode
  - rvm: ruby-head
after_success:
  - git --version
  - git subtree
  - # wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh
  - # git remote add web-client-heroku git@heroku.com:yo-trial-web-client.git
  - # echo "Host heroku.com" >> ~/.ssh/config
  - # echo "   StrictHostKeyChecking no" >> ~/.ssh/config
  - # echo "   CheckHostIP no" >> ~/.ssh/config
  - # echo "   UserKnownHostsFile=/dev/null" >> ~/.ssh/config
  - # heroku keys:clear
  - # yes | heroku keys:add
  - # yes | git subtree push --prefix web-client/dist web-client-heroku master
